<div class="flex flex-col h-screen">
  <!-- Spinner -->
  <div *ngIf="isLoading" class="flex items-center justify-center h-full">
    <p class="text-lg">Tasks list loading...</p>
  </div>

  <!-- No Task Message -->
  <div *ngIf="isTaskExist" class="flex items-center justify-center h-full">
    <p class="text-lg">No task found...</p>
  </div>

  <!-- Toolbar -->
  <div class="flex-shrink-0">
    <div class="h-14 flex justify-between items-center bg-blue-600 text-white shadow-lg">
      <span class="text-xl font-bold ml-4">ToDoList Section</span>
      <div>
        <button class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded mr-2" (click)="navigateToHome()">Dashboard</button>
        <button class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded mr-2" (click)="openDialog(dialogTemplate)">Create new List</button>
        <button class="bg-blue-700 hover:bg-blue-800 text-white font-bold py-2 px-4 rounded" (click)="clearCompletedTasks()">Clear Completed Tasks</button>
      </div>
    </div>
  </div>

  <!-- Content -->
  <div class="flex-grow p-4 sm:p-8 overflow-y-auto">
    <div class="space-y-4"> <!-- Replaced mat-list with a div for spacing -->
      <div *ngFor="let item of items; let i = index" class="mb-4 shadow-md rounded-lg bg-white"> <!-- Replaced mat-list-item with a div -->
        <!-- Task View -->
        <div *ngIf="!item.isEditing" class="flex items-center w-full p-4">
          <div class="flex-grow">
            <div class="text-sm text-gray-500">{{item.date}}: {{item.time}}</div>
            <div class="text-lg font-semibold">{{item.title}}</div>
            <div class="text-base">{{item.description}}</div>
          </div>
          <div class="flex items-center">
            <button class="text-blue-600 hover:text-blue-800 font-bold py-2 px-4 rounded" (click)="editItem(i)">Edit</button>
            <button class="text-red-600 hover:text-red-800 font-bold py-2 px-4 rounded" (click)="deleteItem(dialogTemplateDeletion)">Delete</button>
            <button class="text-green-600 hover:text-green-800 font-bold py-2 px-4 rounded" (click)="openShareDialog(item.title)">Share</button>
            <input type="checkbox" [checked]="item.completed" (change)="onTaskChange($event, item.title, item)" class="ml-4 h-6 w-6">
          </div>
        </div>

        <!-- Deletion Confirmation Dialog -->
        <ng-template #dialogTemplateDeletion>
          <div class="p-4">
            <h2 class="text-xl font-bold mb-4">Are you sure you want to delete this task?</h2>
            <div class="flex justify-end">
              <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded mr-2" (click)="deleteAccount(i, item.title, dialogTemplateDeletion)">Delete task</button>
              <button class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded" (click)="cancelDeletion(dialogTemplateDeletion)">Cancel</button>
            </div>
          </div>
        </ng-template>

        <!-- Edit View -->
        <div *ngIf="item.isEditing" class="w-full p-4">
          <input type="text" [(ngModel)]="item.title" placeholder="Edit title" class="w-full mb-2 p-2 border rounded">
          <input type="text" [(ngModel)]="item.description" placeholder="Edit description" class="w-full mb-2 p-2 border rounded">
          <div>
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded mr-2" (click)="saveItem(i, item.title, item.description)">Save</button>
            <button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded" (click)="cancelEdit(i)">Cancel</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Create List Dialog -->
<ng-template #dialogTemplate>
  <div class="p-4">
    <h2 class="text-xl font-bold mb-4">Create List</h2>
    <div *ngIf="checkingTitleAvailability" class="text-blue-500 mb-2">Checking title name availability...</div>
    <div *ngIf="titleToBeCreated" class="text-green-500 mb-2">Great! This title name is available</div>
    <div *ngIf="titleErrorChecking" class="text-red-500 mb-2">{{titleError}}</div>
    <div>
      <input (blur)="onBlur()" (focus)="onFocus()" [(ngModel)]="taskTitleInput" (input)="createTaskTittle()" placeholder="Enter task title..." class="w-full mb-2 p-2 border rounded">
      <input [(ngModel)]="taskDescriptionInput" (input)="createTaskDescription()" placeholder="Enter task description..." class="w-full mb-2 p-2 border rounded">
      <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" [disabled]="isDisabled" (click)="onCreateList()" [ngClass]="{ 'opacity-50 cursor-not-allowed': isDisabled }">Create task list</button>
    </div>
  </div>
</ng-template>

<!-- Custom Dialog Overlay for Share Dialog -->
<div *ngIf="showShareDialog" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-white rounded-lg shadow-xl max-w-sm w-full">
    <app-share-dialog
      (emailShared)="handleEmailShared($event)"
      (cancelled)="handleShareCancelled()"
    ></app-share-dialog>
  </div>
</div>

